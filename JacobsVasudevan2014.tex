\documentclass[12pt]{amsart}
\usepackage{amssymb}
\usepackage{todonotes}
\usepackage{tensor}

\newcommand{\hoj}[1]{\todo[inline, color=red!20]{HOJ: #1}}
\newcommand{\ram}[1]{\todo[inline, color=blue!20]{RAM: #1}}

\newtheorem{thm}{Theorem}
\newtheorem{prop}{Proposition}
\newtheorem{cor}{Corollary}
\newtheorem{defn}{Definition}

\DeclareMathOperator{\Diff}{Diff}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\U}{U}
\DeclareMathOperator{\SU}{SU}
\DeclareMathOperator{\Fr}{Fr}
\DeclareMathOperator{\Herm}{Herm}
\DeclareMathOperator{\supp}{supp}

\title{A unified approach to advection}

\begin{document}
\maketitle

\section{Introduction}
\label{sec:intro}

  Any geometric object (a function, a density, a tensor, etc) transforms in its own unique way when carried by a diffeomorphism.
As a results, there are a variety of advection schemes for different types of
objects because each type has its own advection PDE.
However, there are certain invariants and relationships
among objects which should be conserved under advection.
For example, if $\rho$ is a density then it's total mass $\int_M \rho$
should be conserved under advection.
More generally, $\int_M f \rho$ should be conserve for a function $f$ 
which is advected.
Moreover, the algebraic structure of complex valued functions (i.e. the ring structure) should be preserved.
If $f$ and $g$ are two complex valued functions, then 
advecting the product $f(\cdot) g(\cdot)$ is equivalent to taking the
product of the advected $f$ and $g$ individually.

Existing schemes are typically focused on advecting an individual 
object of a single type, and it is not clear how to advect objects
of other types in order to respect the relationships mentioned above.
These relationships can be particular important in a variety of scenarios.

\subsection{Climate science}
\label{sec:climate}
The temperature field, $T$, is a function advected by the air
over our planet,
while the fluid density, $\rho$, is a density.
In many climate models scalar functions and densities are multiplied to
define other physically relevent quantites.
For example in the primitive equations, we define the equation of state $p = \rho R T$.
If $T$ and $\rho$ are advected passively, then the
thermodynamic energy $\int_{S^2}p$ should be constant in time.
This baseline behavior is a pre-requisite for having confidence in a climate model, as the energy budget of the climate is an object of concern in weather prediction.

\subsection{Safety margins}
\label{sec:safety}
\todo[inline]{Another example}

\subsection{Advection of signed measures}
\label{sec:signed}
When there are two ways of doing something, who's to say which is better.

\subsection{An example involving the ring structure of functions}


\subsection{An example}
\todo[inline]{Here we advect a measure $\mu$ via Transfer-operator theory (w/o describing the theory in detail).
and we advect a function $f$ via Koopman operator theory (again, no details).
We then compute $\int f \mu$ in time, to find it is not constant (bum bum bah!).  We refer to the appendices to describe the details.
Moreover, we could not that $\int \mu$ is not conserved, nor is $\sup(f)$.}

\section{Background}
\label{sec:background}
\todo[inline]{Put literature sruvey here.
Peron-Frobenius, Koopmanism, Transfer operators,
Henrion-Korda,etc.}

\section{The geometry of half-densities}
\label{sec:half_densities}

In differential geometry, the domain of concern is
a differentiable manifold, $M$, and objects (such as
functions, vector-fields, and densities) are typically defined
as maps from points in $M$.
However, the inner-product space
of half-densities on $M$ allows us to redefine these concepts
as operations on an inner-product space.

Before introduing the definition of a half-density, it is useful
to characterize densities in a geometric way.
A density on a vector-space, $V$, is merely a way of measuring the volume
of parallelopipeds.
Mathematically, this means assiging a number to each basis in a way which transforms appropriately under linear changes of coordinates.
If we denote the set of basis, or frames, of $V$ by $\Fr(V)$,
 then there is a natural $\GL(n)$ action on $\Fr(V)$ given by
 \begin{align*}
  v = (v_1,\dots,v_n) \in \Fr(V) \stackrel{A \in \GL(n)}{\mapsto} v \cdot A = (A_1^j v_j, \dots, A_n^j v_j) \in \Fr(V).
 \end{align*}
A density on $V$ is merely a map $\mu_V: \Fr(V) \to \mathbb{R}^+$ such that
\begin{align*}
  \mu_V( v \cdot A) = \mu_V(v) | \det(A) |
\end{align*}
for any $A \in \GL(n)$.
We can bundle-ize these notions to define a density on a manifold by defining the frame bundle.
\begin{defn}
  The \emph{frame bundle} of $M$, is the fiber bundle $\pi_{\Fr}:\Fr(M) \to M$ whose fiber over $x \in M$ is $\pi_{\Fr}^{-1}(x) = \Fr( T_x M)$.
A \emph{density} on a manifold, is a map $\mu:\Fr(M) \to \mathbb{C}$ such that $\mu(x): \Fr(T_xM) \to \mathbb{R}^+$ is a density on the vector-space $T_xM$.
\end{defn}
 The integral of a density on $M$ is given by the standard partition of unity argument, usually applied to $n$-forms \cite[Chapter 14]{Lee2006}.\footnote{Integration of $n$-forms usually requires a orientation, however densities may be integrated on any manifold.}
This (non-standard) characterization of a density allows us to introduce half-densities without further delay.

\begin{defn}
  [See \S 5.4 \cite{GuilleminSternberg1970} or Appendix A \cite{BatesWeinstein1997}]
  A half-density on a manifold $M$, is a function $\psi : \Fr(M) \to \mathbb{C}$ such that
  \begin{align*}
    \psi( v \cdot A) = \psi( v ) | \det(A) |^{1/2}
  \end{align*}
  for any $A \in \GL(n)$.
  We denote the space of half-densities by $|\bigwedge^n(M)|^{1/2}$.
\end{defn}
\hoj{should say something about boundary conditions in this definition}
On a chart $U \subset M$ with coordinates $x^1,\dots,x^n$ we always have a local volume form $d{\bf x} = dx^1\wedge dx^2 \wedge \cdots \wedge dx^n$.
If we think of this volume form as a function on $\Fr(U)$, then we may take the square-root of this function to get a locally defined half-density $\sqrt{d{\bf x}}$.
Any half-density $\psi \in | \bigwedge^n(M)|^{1/2}$ is locally expressed as
\begin{align*}
  \psi(x) \stackrel{locally}{=} f(x) \sqrt{d {\bf x}}
\end{align*}
for some complex-valued function $f:U \to \mathbb{C}$.


\begin{prop}
  The space of half-densities is a complex inner-product space.
\end{prop}
\begin{proof}
 If $\psi_1,\psi_2 \in |\bigwedge^n(M)|^{1/2}$,$v \in \Fr(M)$, $c \in \mathbb{C}$, and $A \in \GL(n)$ then
  \begin{align*}
    \psi_1( v A) + c  \psi_2(v A) = ( \psi_1(v) + c\psi_2(v) ) | \det(A) |^{1/2}.
  \end{align*}
  This shows that $\psi_1 + c \psi_2$ is a half-density, and so $|\bigwedge^n(M)|^{1/2}$ is a vector space.
  Moreover, we see that
  \begin{align*}
    \psi_1(v \cdot A) \bar{\psi}_2( v \cdot A) = \psi_1(v)\bar{\psi}_2(v) | \det(A) |.
  \end{align*}
  Thus $\psi_1( \cdot) \bar{\psi}_2( \cdot)$ is a complex-valued density which we may integrate.  The complex inner-product is given by
  \begin{align*}
    \langle \psi_1 \mid \psi_2 \rangle = \int_M \psi_1 \bar{\psi}_2.
  \end{align*}
\end{proof}

  We call the completion of $| \bigwedge^n(M) |^{1/2}$ with respect to $\langle \cdot \mid \cdot \rangle$ the \emph{canonical Hilbert space of $M$}, which we denote by $L_2(M)$.
One should understand that $L_2(M)$ is not a space of functions, and is \emph{not} identical to an $L_2$-space of functions on $M$ which would require one choose a volume form.
It is notable that the inner product on half-densities has been defined intrinisically (i.e. independent of any choice of coordinates).  As a result it should yield the same result regardless of how we transform a coordinate system under a diffeomorphism of $M$.

\begin{prop}
  Let $\Diff(M)$ denote the diffeomorphism group of $M$, and let $C^{\infty}(M)$ denote the vector-space of smooth real-valued functions.  Both $\Diff(M)$ and $C^{\infty}(M)$ act unitarily on $L_2(M)$.
\end{prop}
\begin{proof}
  Let $\phi \in C^{\infty}(M)$ and consider the action on $L_2(M)$ given by
  \begin{align*}
    \psi \mapsto e^{i \phi} \cdot \psi.
  \end{align*}
  It is simple to check that $\langle e^{i \phi} \psi_1 \mid e^{i \phi} \psi_2 \rangle = \langle \psi_1 \mid \psi_2 \rangle$.  Thus $C^\infty(M)$ acts unitarily.

  Let $\varphi \in \Diff(M)$ and $\psi_1,\psi_2 \in | \bigwedge^n(M) |^{1/2}$.  Then the push-forward of $\psi_i$ by $\varphi$ is given by right composition with $\varphi^{-1}$.  That is to say
  \begin{align*}
    \varphi_* \psi_i( v_1,\dots,v_n ) = \psi_i( T_x\varphi^{-1} \cdot v_1,\dots,T_x\varphi^{-1} \cdot v_n ).
  \end{align*}
  It is then simple to observe that $(\varphi_* \psi_1 ) (\varphi_* \bar{\psi}_2)$ is a density which is equivalent to $\varphi_*( \psi_1 \bar{\psi}_2)$.
  Thus we find
  \begin{align*}
    \langle \varphi_* \psi_1 \mid \varphi_* \psi_2 \rangle = \int_M \varphi_*( \psi_1 \bar{\psi}_2) = \int_{\varphi^{-1}(M)} \psi_1 \bar{\psi}_2 = \langle \psi_1 \mid \psi_2 \rangle.
  \end{align*}
\end{proof}

\begin{cor}
  The space of smooth vector-fields, $\mathfrak{X}(M)$, are anti-Hermetian operators on $L_2(M)$.
\end{cor}
\begin{proof}
  As the diffeomorphisms are unitary operators, it must be the case that the infinitesimal generators, i.e. vector fields, are anti-Hermetian operators.
\end{proof}

Given a vector field $X \in \mathfrak{X}(M)$, the anti-Hermetian action on $\psi \in |\bigwedge^n(M)|^{1/2}$ is given in coordinates by
\begin{align*}
  X[\psi](x) \stackrel{locally}{=} \left( X^i(x) \partial_i f(x) + \frac{1}{2} f(x) \partial_iX^i(x) \right) \sqrt{d {\bf x} }
\end{align*}
where $\psi$ is locally $f \sqrt{d {\bf x}}$.

 The space of Hermetian operators on $L_2(M)$ is particularly important for understanding how to view real valued functions as operators.
   We denote the set of Hermetian operators on $| \bigwedge^n(M) |^{1/2}$ by $\Herm(M)$.
 A real-valued function $H \in C^0(M)$ induces a Hermetian operator
on $| \bigwedge^n(M)|^{1/2}$, denoted $\widehat{H}$, by
\begin{align*}
  (\widehat{H} \cdot \psi)(v) = H(x) \psi(v) \quad , \quad \forall v \in \Fr_x M.
\end{align*}
In fact, any Hermetian operator is of the form $U \hat{H} U^*$ for some function $H$ and some unitray operator $U$.\cite[Chapter VII]{ReedSimon1980}.
Diffeomorphisms transform functions in a consistent way, and so we can hope to densely capture the unitary orbits of a function.

\begin{prop}
  Let $\varphi \in \Diff(M)$ and let $U \in \U(L_2(M))$ be the induced unitary operator.  Let $H \in C^{\infty}(M)$.  Then $\widehat{ \varphi_*H} = U \hat{H} U^*$.
\end{prop}
\begin{proof}
  By definition
  \begin{align*}
    (\widehat{\varphi_*H} \cdot \psi )(v) &= H(\varphi^{-1}(x)) \psi(v) \\
    &= H(\varphi^{-1}(x)) \varphi^*\psi( \varphi^{-1} \cdot v) \\
    &= ( \hat{H} \cdot \varphi^* \psi)( \varphi^{-1} \cdot v) \\
    &= \varphi_* ( \hat{H}( \varphi^* \psi)) (v) \\
    &= (U\hat{H}U^* \cdot \psi) (v).
  \end{align*}
\end{proof}

Finally, let $\mu$ be a density.  The right action of $\mu$ under a diffeomorphism $\varphi$ is given by a pull-back
\begin{align*}
  \varphi^* \mu (v) = \mu ( \Fr(\varphi) \cdot v).
\end{align*}
Given a vector-field $X \in \mathfrak{X}(M)$ we define the Lie-derivative
of $\mu$ as
\begin{align*}
  \pounds_X[ \mu] = \left. \frac{d}{dt} \right|_{t=0} \varphi_t^* \mu
\end{align*}
where $\varphi_t$ is the flow map of $X$.
It is not uncommon that one is asked to solve a Louiville equation
\begin{align*}
  \partial_t \mu + \pounds_X[\mu] = 0.
\end{align*}
In local coordinates $\mu(x) = \rho(x) d {\bf x}$ for some density function $\rho$.  Louiville's equation takes the form
\begin{align*}
  \partial_t \rho + \partial_i ( X^i \rho) = 0.
\end{align*}
\begin{prop}
  Let $X \in \mathfrak{X}(M)$ and let $\psi \in L_2(M)$ satisfiy the advection equation
  \begin{align*}
    \partial_t \psi + \pounds_X[\psi] = 0.
  \end{align*}
  Then the measure $\mu = \psi \cdot \bar{\psi}$ satisfies the Louiville equation.  Conversely, if $\mu$ satisfies the Louiville equation then there exists a half-density $\psi$ which satisfies the above advection equation and $\psi \cdot \bar{\psi} = \mu$.
\end{prop}
\begin{proof}
  \hoj{proof pending}
\end{proof}


\section{Flux through boundaries}
\hoj{In order for us to deal with charts
we need to be able to deal with boundaries.
This is certainly doable, and in fact it is a good
thing.  If we can handle flux across boundaries
we can probably resolve dynamics for out-flowing
submanifolds of non-compact manifolds.
Additionally, the way to do hybrid systems
will be clear (transition maps between
charts will be a special case of transition
maps in hybrid systems).
Lastly, by considering systems with flux
across the boundaries we will no longer be
using anti-Hermetian operators.
No problem.  We can at least muse on random
systems (particular Brownian motion in Rn).
That we can do all these special cases puts
us further ahead of the Koopman/FP people.
}

Let $U,V \subset M$ be open sets such that $M \ U = \bar{V}$.
and let $i_U,i_V: U,V \hookrightarrow M$ be the embeddings.
We can consider the set $i^*_U L^2(M)$.


\subsection{Noncompact manifolds}
  In the previous section we restricted ourselves to the
case where $M$ was a compact manifold, and we always considered
vector-fields which were tangent to the boundary of $M$.
However, this may be too restrictive for most applications, and
we'd like to expand these constructions to handle non-compact
manifolds.
In particular we will resolve the dynamics on out-flowing
submanifolds of a (perhaps noncompact) manifold $M$.

\begin{defn}
  Let $M$ be a manifold and $U \subset M$ be an open subset.
  Let $X \in \mathfrak{X}(M)$.
  We call $U$ \emph{outflowing} if there exists a $t > 0$
  such that $U \subset \exp(t X) \cdot U$.
  If there exists a $t>0$ such $\exp(t X) \cdot U \subset U$.
\end{defn}

\begin{prop}
  Let $M$ be a manifold, $X \in \mathfrak{X}(M)$, and let $U \subset M$ be an open set.  The evolution equation on $L^2(\bar{U})$ given by
  \begin{align}
    \partial_t \psi + \pounds_{X|_{\bar{U}}}[\psi] = 0 \label{eq:restricted}
  \end{align}
  is well-posed if $U$ is outflowing.
  If $U$ is not outflowing then \eqref{eq:restricted} is underdetermined.
  If $U$ is inflowing the equation is well posed upon restriction of $\psi$ to densities with vanishing derivatives on the boundary of $U$.
\end{prop}
\begin{proof}
  Let $e^{tX}:M \to M$ be the flow\footnote{This notation suggests that the flow extends to all of $M$. However, the proof holds without this assumption.} of $X$.
  If \eqref{eq:restricted} is well posed, then the solution is given by the following sequence of steps
  \begin{enumerate}
    \item Extend the initial condition $\psi_0 \in L^2( \bar{U})$ to another half-density $\Psi_0 \in L^2(M)$.
    \item Solve the evolution equation on $M$ given by $\partial_t \Psi + \pounds_X[\Psi] = 0$.
    \item Then $\psi_t = \Psi_t |_{\bar{U}}$ solves \eqref{eq:restricted}.
  \end{enumerate}
  The solution to the system given in step (2) is $\Psi_t = \Psi_0 \circ \Fr( \exp( -tX) )$.
  If $U$ is outflowing, then $U \subset \exp(tX) \cdot U$.
  More pertinant is that $\exp(tX) \cdot U \subset U$.
  We observe directly that
  \begin{align*}
    \psi_t = \left. \Psi_0 \circ \Fr( \exp( -tX) ) \right|_{\bar{U}}
    \equiv \psi_0 \circ \Fr( \exp(-tX) ) |_{\bar{U}}
  \end{align*}
  is independ of the extension $\Psi_0$.
  The above algorithm yields a unique solution in this case.
  Otherwise, if $\psi$ is not outflowing, the algorithm yields a
  family of solutions parametrized by extensions of of $\psi_0$.
  If we consider half-densities which vanish on the boundary of $U$ and extensions which vanish outside of $U$ then this algorithm yields a unique solution for inflowing manifolds as well.
\end{proof}

The case of a submanifold which is niether inflowing nor outflowing is slightly more complicated.  What is needed is a gurantee that points which leave will never return.  This is addressed in the following definition and proposition.

\begin{defn}[\S 13 \cite{Lee2006}]
  Let $N \subset M$ be a non-meager submanifold with boundary $\partial N$.
  We call $v \in T_{\partial N}M$ \emph{inward pointing} if $v$ is transversed to $TN$ and there exists a curve $\gamma: [0,1] \to M$ such that $\gamma'(0) = v$ and $\gamma(t) \in N$ for all $t \in [0,1]$.
We call $v$ \emph{outward pointing} if $-v$ is inward pointing.
\end{defn}

\begin{prop}
  Let $N \subset M$ be a non-meager submanifold with boundary $\partial N$.
  Let $X \in \mathfrak{X}(M)$ be a vector field.
  Define the subsets
  \begin{align*}
    N_{in} &= \{ x \in \partial N \mid X(x) \text{ is inward pointing} \} \\
    N_{out}&= \{ x \in \partial N \mid X(x) \text{ is outward pointing} \} \\
    {\rm traj}^-(N_{\rm in}) &= \{ \phi_{t}(x) \mid x \in N_{\rm in}, t < 0 \} \\
    {\rm traj}^+(N_{\rm out}) &= \{ \phi_{t}(x) \mid x \in N_{\rm out}, t > 0 \},
  \end{align*}
  where $\phi_t$ is the flow of $X$.
  If ${\rm traj}^-(N_{\rm in})$ and ${\rm traj}^+(N_{\rm out})$ are disjoint , then any half-density $\Psi_0$ on $N$ which vanishes on $N_{\rm in}$ has a unique solution to the half-density advection equation induced by $X|_{N}$.
\end{prop}
\begin{proof}
  The solution to the half-density advection equation (if one exists) is given by $\Psi_0 \circ \Fr( \Phi_t)$.  We can extend $\Psi_0$ to a half-density on $N \cup {\rm traj}^-(N_{\rm in})$ which is $0$ on all of $N_{\rm in}$.
  Because ${\rm traj}^-(N_{\rm in})$ and ${\rm traj}^+(N_{\rm out})$ are disjoint, we are guranteed that points which leave $N$ will never return.
  Thus restricting $\Psi_0 \circ \Fr( \Phi_t)$ to $N$ yields the solution of the half-density advection equation on $N$.
\end{proof}


\section{A semidiscretization}
\label{sec:semi_discretization}

We will first present the most simple spectral method
which seems natural given the constructions presented thus far.
Let $M$ be a compact manifold and let
$\psi_1,\psi_2,\dots$ be a Hilbert basis of half-densities
on $M$ with Neumann boundary conditions
and let $\tilde{\psi}_1,\tilde{\psi}_2,\dots$ denote the dual basis
with respect to the inner-product on half-densities.
This choice defines a series of isomorphisms which we will
denote with the same letter.
Firstly, there is the isomorphism which extracts the coefficients of 
a half-density with respect to this basis
\begin{align*}
  [\cdot ] : \psi \in L^2(M) \mapsto [\psi] \in \ell^2( \mathbb{C})
\end{align*}
where the $i$th member of $[\psi]$ is $\langle \tilde{\psi}_i , \psi \rangle$.

Similarly, for a linear operator on $L^2(M)$ we define $[\cdot ]: L( L^2(M)) \to L( \ell^2( \mathbb{C}) )$ in a consitent way (i.e. by push-forward).  That is, for a linear operator $A \in L( L^2 (M))$ we define $[A] [\psi] = [A \cdot \psi]$. 

Given a vector-field $X \in \mathfrak{X}(M)$ which is tangent to the
boundary, we observe
\begin{align*}
  [X]\indices{^i_j} = \langle \tilde{\psi}_i , \pounds_X[ \psi_j ] \rangle.
\end{align*}
We can formally view the flow of $X$ by considering the formal
matrix exponential
\begin{align*}
  [U_t] = \exp( t[X] ) = \sum_{k=0}^{\infty} \frac{t^k}{k!} [X]^k.
\end{align*}
which converges since $[X]$ is anti-Hermetian.
The evolution of a half-density carried by the flow can be determined by the evolution of coefficients.
That is to say we may compute $[\psi_0]$, apply $[U_t]$ to get $[U_t] \cdot [\psi_0]$.
Then we may invert $[\cdot]$ to obtain $\psi_t$.
Densities are obtained by squaring the coefficients of $\psi$.
So if $\rho = |\psi|^2$ we may view its discretization as the sum of non-negative functions with non-negative coefficients $\rho = |c_i|^2 |\psi_i|^2$.
This allows us to advect $\rho$ in a similar manner.
Namely, $[\rho_0]_i$ is advected to $[\rho_t]_i = | [U_t]\indices{^i_j} \cdot [\sqrt{\rho}_0]_j |^2$.
Finally, functions may be advected by sending $[\hat{f}]$ to $[U_t] [\hat{f}] [U_t]^*$.

A semidiscretization is provided by truncating these expansions.
so that we only consider an $n \times n$ anti-Hermetian matrix, $[X]_n$
and we can then model the flow using the $\SU(n)$ matrix $\exp( t [X]_n)$.



\section{Error analysis}
\label{sec:error}

\ram{I writes this}

\section{Examples}
\label{sec:examples}

\todo[inline]{We both come up with examples}

\section{Conclusion}
\label{sec:conclusion}


\subsection{Acknowledgements}
\label{sec:ack}

Yo!  Dmitry Pavlov, Darryl Holm, Jaap Eldering... tanks!

\appendix

\section{Transfer operator theory}

\hoj{I write this}

\section{Koopmanism}
\hoj{I write this}

\bibliographystyle{amsalpha}
\bibliography{/Users/hoj201/Dropbox/hoj_2014}

\end{document}

%%%  OLD WRITING

\subsection{Specific problems}
Let $X$ be a vector-field on a compact manifold $M$.
A scalar function $q_0 \in C^1( M)$ is
advected by $X$ through the partial-differential equation
given in local coordinates by
\begin{align*}
  \partial_t q(x) + X^i(x) \partial_i q(x) = 0.
\end{align*}
The solution is $q(x,t) = q_0( F_t^{-1}(x) )$ where $F_t : M \to M$ is the flow of the vector-field $X$.

Similarly, a density $\rho_0$ is advected by
\begin{align*}
  \partial_t \rho + \partial_i ( \rho f^i) = 0
\end{align*}
and $\rho( \cdot , t)$ is related to $\rho_0$ by $\rho(x,t) = \det( \partial_j F_t^i(x) )^{-1} \rho_0( F_t^{-1}(x) )$.

Given a density and a function, we can consider the scalar product $\langle \rho , q \rangle = \int \rho(x) q(x) dx$.
This duality between densities and functions is \emph{the defining property of densities!}  Therefore, a coordinate change, perhaps induced by a smooth evolution, should not alter the inner product between a function and a density.
In otherwords, the inner product between a density and a function is constant in time under the evolution of a vector field.

Lastly, the advection equation for vector-fields is
\begin{align*}
  \partial_t g^i + f^j \partial_j g^i - g^j \partial_j f^i = 0.
\end{align*}
The solution is $g^i(x,t) = \partial_j F^i_t(x) \cdot g^j_0(F_t^{-1}(x))$.
It is notable that $g_t$ is identical to $g_0$ modulo a change of coordinates
given by $F_t$.
This implies that topological properties of $g_0$ such as the asymptotic behavior, index of fixed points, etc, is captured in $g_t$ as well.
Other properties follow, for example if $q_0/\rho_0$ is an invariant
function/density of $g_0$, then $q_t/\rho_t$ is an invariant function
/density of $g_t$.

When we descritize one advection equation
it is customary to ignore these relationships
and the other advection equations.
However,
ignoring these relationships can lead spurious behavior.
For example:
\begin{enumerate}
  \item The sign of a probability density can become negative upon discretization.
  \item The extremal values of a function can become time dependent upon discretization.
  \item A stable region of a vector-field can advect itself to be an unstable region in the discrete scheme.
\end{enumerate}

``Understanding the qualitative behavior of a dynamical system'' is another way of saying ``understanding the invariants of a dynamical system under all changes in coordinates''.
Therefore questions of qualitative behavior must be answereable in terms of entities which are invariant under changes in coordinates, entities such as:
the duality between densities and functions, the Lie-bracket of vector fields, and the orientation of a signed measure.
Such descriptions are of particular importance in high-dimensional systems where high-accuracy is infeasible but qualitatively accurate descriptions might be.
In this paper we will construct an integrator designed to juggle all
of these relationships simultaneously for the purpose of studying qualitative behavior in a range of scenarios.

\todo[inline]{Perhaps we should consider
introducing some naive discretizations
to show what can go wrong.
In particular, the posibility 
of negative probability measures}
